
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prayer Times - Egypt</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #dbe6f6, #c5796d);
      color: #2c3e50;
      text-align: center;
      padding: 40px;
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .date-box {
      font-size: 1.2em;
      margin-bottom: 20px;
      color: #fff;
      background-color: #2c3e50;
      padding: 10px;
      border-radius: 10px;
      display: inline-block;
    }
    .countdown-box, .previous-box {
      font-size: 1.3em;
      color: #e74c3c;
      margin: 10px 0;
      font-weight: bold;
    }
    .prayer-table {
      background: #ffffffcc;
      margin: 0 auto;
      padding: 20px;
      border-radius: 15px;
      width: 320px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    .prayer-time {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #ddd;
      font-size: 1.1em;
    }
    .prayer-time:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <h1>Prayer Times - Egypt</h1>
  <div class="date-box" id="hijriDate">Loading Hijri date...</div>
  <div class="countdown-box" id="countdown">Calculating next prayer...</div>
  <div class="previous-box" id="previous">Calculating time since last prayer...</div>
  <div class="prayer-table" id="prayerTimes">
    <p>Loading prayer times...</p>
  </div>

  <!-- Adhan Audio -->
  <audio id="adhanAudio">
    <source src="https://ia600103.us.archive.org/27/items/azan_20250517/azan.mp3" type="audio/mpeg">
  </audio>

  <!-- Beep Sound -->
  <audio id="beepAudio">
    <source src="https://ia600101.us.archive.org/7/items/beep-07a/beep-07a.wav" type="audio/wav">
  </audio>

  <script>
    async function loadPrayerTimes() {
      const response = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Cairo&country=Egypt&method=5');
      const data = await response.json();
      const times = data.data.timings;
      const hijriDate = data.data.date.hijri;

      const hijriDisplay = `${hijriDate.weekday.ar} - ${hijriDate.day} ${hijriDate.month.ar} ${hijriDate.year} هـ`;
      document.getElementById('hijriDate').textContent = hijriDisplay;

      const prayerList = ['Fajr', 'Sunrise', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
      const container = document.getElementById('prayerTimes');
      container.innerHTML = '';

      const prayerTimes = [];

      prayerList.forEach(prayer => {
        const timeStr = times[prayer];
        let [hour, minute] = timeStr.split(':').map(Number);
        const ampm = hour >= 12 ? 'PM' : 'AM';
        let displayHour = hour % 12;
        displayHour = displayHour === 0 ? 12 : displayHour;
        const displayTime = `${displayHour}:${minute.toString().padStart(2, '0')} ${ampm}`;

        const now = new Date();
        const prayerTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hour, minute, 0);
        prayerTimes.push({ name: prayer, time: prayerTime });

        const row = document.createElement('div');
        row.className = 'prayer-time';
        row.innerHTML = `<span>${prayer}</span><span>${displayTime}</span>`;
        container.appendChild(row);
      });

      const adhanAudio = document.getElementById('adhanAudio');
      const beepAudio = document.getElementById('beepAudio');
      let playedAdhan = {};
      let playedBeep = {};

      function updateTimers() {
        const now = new Date();

        let nextPrayer = null;
        let prevPrayer = null;

        for (let i = 0; i < prayerTimes.length; i++) {
          const pt = prayerTimes[i];
          if (pt.time > now) {
            nextPrayer = pt;
            prevPrayer = i > 0 ? prayerTimes[i - 1] : null;
            break;
          }
        }

        if (!nextPrayer) {
          const fajrTomorrow = new Date(prayerTimes[0].time);
          fajrTomorrow.setDate(fajrTomorrow.getDate() + 1);
          nextPrayer = { name: 'Fajr (next day)', time: fajrTomorrow };
          prevPrayer = prayerTimes[prayerTimes.length - 1];
        }

        // Countdown to next
        const diffMs = nextPrayer.time - now;
        const minutes = Math.floor(diffMs / 60000);
        const seconds = Math.floor((diffMs % 60000) / 1000);
        document.getElementById('countdown').textContent =
          `Time until ${nextPrayer.name}: ${minutes}m ${seconds}s`;

        // Time since previous
        if (prevPrayer) {
          const diffPrev = now - prevPrayer.time;
          const minPrev = Math.floor(diffPrev / 60000);
          const secPrev = Math.floor((diffPrev % 60000) / 1000);
          document.getElementById('previous').textContent =
            `Time since ${prevPrayer.name}: ${minPrev}m ${secPrev}s`;
        }

        // Adhan + Beep logic
        prayerTimes.forEach(pt => {
          const keyAdhan = pt.name + pt.time.toDateString();
          const keyBeep = pt.name + "-20min-" + pt.time.toDateString();
          const diff = pt.time - now;

          if (Math.abs(diff) < 1000 && !playedAdhan[keyAdhan]) {
            adhanAudio.play();
            playedAdhan[keyAdhan] = true;
          }

          if (Math.abs(diff - 20 * 60 * 1000) < 1000 && !playedBeep[keyBeep]) {
            beepAudio.play();
            alert("Time left to next prayer: 20 minutes");
            playedBeep[keyBeep] = true;
          }
        });
      }

      updateTimers();
      setInterval(updateTimers, 1000);
    }

    loadPrayerTimes();
  </script>
</body>
</html>
